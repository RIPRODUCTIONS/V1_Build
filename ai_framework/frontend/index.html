<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Framework Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online { background-color: #4CAF50; }
        .status-offline { background-color: #f44336; }
        .status-error { background-color: #ff9800; }
        .status-busy { background-color: #2196F3; }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-weight: 500;
            color: #666;
        }

        .metric-value {
            font-weight: 600;
            color: #333;
        }

        .department-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .department-card {
            background: white;
            border-radius: 12px;
            padding: 18px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .department-card h4 {
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .agent-list {
            list-style: none;
        }

        .agent-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            font-size: 0.9rem;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffa726 0%, #ff7043 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #66bb6a 0%, #43a047 100%);
        }

        .real-time {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .real-time h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .websocket-status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .websocket-connected {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .websocket-disconnected {
            background: #ffebee;
            color: #c62828;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #f44336;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .department-grid {
                grid-template-columns: 1fr;
            }

            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AI Framework Dashboard</h1>
            <p>Master Control Center for 50+ Specialized AI Agents</p>
        </div>

        <!-- Real-time Status -->
        <div class="real-time">
            <h3>Real-time Status</h3>
            <div id="websocket-status" class="websocket-status websocket-disconnected">
                Disconnected
            </div>
            <p>Live updates every 5 seconds via WebSocket</p>
        </div>

        <!-- System Controls -->
        <div class="controls">
            <button class="btn btn-success" onclick="refreshDashboard()">üîÑ Refresh Dashboard</button>
            <button class="btn btn-warning" onclick="restartAllAgents()">üîÑ Restart All Agents</button>
            <button class="btn btn-danger" onclick="shutdownSystem()">üõë Shutdown System</button>
            <button class="btn" onclick="executeEmergencyProtocol('system_overload')">‚ö†Ô∏è System Overload Protocol</button>
            <button class="btn" onclick="executeEmergencyProtocol('security_breach')">üîí Security Breach Protocol</button>
        </div>

        <!-- Dashboard Overview -->
        <div class="dashboard-grid">
            <div class="card">
                <h3>üìä System Overview</h3>
                <div id="system-overview">
                    <div class="loading">Loading system overview...</div>
                </div>
            </div>

            <div class="card">
                <h3>üö® Active Alerts</h3>
                <div id="active-alerts">
                    <div class="loading">Loading alerts...</div>
                </div>
            </div>

            <div class="card">
                <h3>üìà Performance Metrics</h3>
                <div id="performance-metrics">
                    <div class="loading">Loading metrics...</div>
                </div>
            </div>

            <div class="card">
                <h3>üß≠ KPIs & Insights</h3>
                <div id="kpis-insights">
                    <div class="loading">Loading KPIs...</div>
                </div>
            </div>

            <div class="card">
                <h3>üïí Recent Activity</h3>
                <div id="recent-activity">
                    <div class="loading">Loading activity...</div>
                </div>
            </div>
        </div>

        <!-- Department Status -->
        <h2 style="color: white; margin: 30px 0 20px 0; text-align: center;">üè¢ Department Status</h2>
        <div id="department-grid" class="department-grid">
            <div class="loading">Loading departments...</div>
        </div>

        <!-- Individual Agent Status -->
        <h2 style="color: white; margin: 30px 0 20px 0; text-align: center;">ü§ñ Agent Status</h2>
        <div id="agent-grid" class="dashboard-grid">
            <div class="loading">Loading agents...</div>
        </div>
    </div>

    <script>
        // Global variables
        let websocket = null;
        let dashboardData = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeWebSocket();
            refreshDashboard();
        });

        // WebSocket connection
        function initializeWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss' : 'ws';
            const wsUrl = `${protocol}://${window.location.host}/ws`;
            websocket = new WebSocket(wsUrl);

            websocket.onopen = function(event) {
                updateWebSocketStatus(true);
                console.log('WebSocket connected');
            };

            websocket.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    dashboardData = data;
                    updateDashboard(data);
                } catch (error) {
                    console.error('Error parsing WebSocket message:', error);
                }
            };

            websocket.onclose = function(event) {
                updateWebSocketStatus(false);
                console.log('WebSocket disconnected');
                // Try to reconnect after 5 seconds
                setTimeout(initializeWebSocket, 5000);
            };

            websocket.onerror = function(error) {
                console.error('WebSocket error:', error);
                updateWebSocketStatus(false);
            };
        }

        function updateWebSocketStatus(connected) {
            const statusElement = document.getElementById('websocket-status');
            if (connected) {
                statusElement.textContent = 'Connected';
                statusElement.className = 'websocket-status websocket-connected';
            } else {
                statusElement.textContent = 'Disconnected';
                statusElement.className = 'websocket-status websocket-disconnected';
            }
        }

        // API functions
        async function apiCall(endpoint, method = 'GET', body = null) {
            try {
                const baseUrl = `${window.location.protocol}//${window.location.host}`;
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };

                if (body) {
                    options.body = JSON.stringify(body);
                }

                const response = await fetch(`${baseUrl}${endpoint}`, options);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                console.error('API call failed:', error);
                showError(`API call failed: ${error.message}`);
                return null;
            }
        }

        // Dashboard functions
        async function refreshDashboard() {
            try {
                const data = await apiCall('/api/dashboard/overview');
                if (data) {
                    dashboardData = data;
                    updateDashboard(data);
                }
            } catch (error) {
                console.error('Failed to refresh dashboard:', error);
                showError('Failed to refresh dashboard');
            }
        }

        function updateDashboard(data) {
            updateSystemOverview(data);
            updateActiveAlerts(data);
            updatePerformanceMetrics(data);
            updateKpisInsights(data);
            updateRecentActivity(data);
            updateDepartmentGrid(data.departments || {});
            updateAgentGrid(data);
        }

        function updateSystemOverview(data) {
            const overview = data.overview || {};
            const element = document.getElementById('system-overview');

            element.innerHTML = `
                <div class="metric">
                    <span class="metric-label">Total Agents:</span>
                    <span class="metric-value">${overview.total_agents || 0}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Active Agents:</span>
                    <span class="metric-value">${overview.active_agents || 0}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Overall Efficiency:</span>
                    <span class="metric-value">${(overview.overall_efficiency || 0).toFixed(1)}%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Dashboard Status:</span>
                    <span class="metric-value">${data.dashboard_status || 'Unknown'}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">System Health:</span>
                    <span class="metric-value">${data.system_health || 'Unknown'}</span>
                </div>
            `;
        }

        function updateActiveAlerts(data) {
            const alerts = data.alerts || [];
            const element = document.getElementById('active-alerts');

            if (alerts.length === 0) {
                element.innerHTML = '<div style="color: #4CAF50; text-align: center; padding: 20px;">‚úÖ No active alerts</div>';
                return;
            }

            let alertsHtml = '';
            alerts.forEach(alert => {
                alertsHtml += `
                    <div class="metric">
                        <span class="metric-label">${alert.type}</span>
                        <span class="metric-value" style="color: #f44336;">${alert.message}</span>
                    </div>
                `;
            });

            element.innerHTML = alertsHtml;
        }

        function updatePerformanceMetrics(data) {
            const overview = data.overview || {};
            const element = document.getElementById('performance-metrics');

            element.innerHTML = `
                <div class="metric">
                    <span class="metric-label">Success Rate:</span>
                    <span class="metric-value">${(overview.success_rate || 0).toFixed(1)}%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Avg Task Duration:</span>
                    <span class="metric-value">${(overview.avg_task_duration || 0).toFixed(2)}s</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Total Tasks:</span>
                    <span class="metric-value">${overview.total_tasks || 0}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Failed Tasks:</span>
                    <span class="metric-value">${overview.failed_tasks || 0}</span>
                </div>
            `;
        }

        function updateKpisInsights(data) {
            const container = document.getElementById('kpis-insights');
            const kpis = data.kpis || {};
            const insights = data.insights || [];
            let html = '';
            html += `
                <div class="metric">
                    <span class="metric-label">Throughput/min:</span>
                    <span class="metric-value">${(kpis.throughput_per_min || 0).toFixed(2)}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Success Rate:</span>
                    <span class="metric-value">${(kpis.success_rate || 0).toFixed(1)}%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Avg Task Duration:</span>
                    <span class="metric-value">${(kpis.avg_task_duration_s || 0).toFixed(2)}s</span>
                </div>
            `;
            if (insights.length > 0) {
                html += '<div style="margin-top:10px;">';
                insights.slice(0,3).forEach(i => {
                    html += `<div class="metric"><span class="metric-label">Insight:</span><span class="metric-value">${i.message}</span></div>`;
                });
                html += '</div>';
            }
            container.innerHTML = html;
        }

        function updateRecentActivity(data) {
            const activity = data.recent_activity || [];
            const element = document.getElementById('recent-activity');

            if (activity.length === 0) {
                element.innerHTML = '<div style="color: #666; text-align: center; padding: 20px;">No recent activity</div>';
                return;
            }

            let activityHtml = '';
            activity.slice(0, 5).forEach(item => {
                activityHtml += `
                    <div class="metric">
                        <span class="metric-label">${item.agent_name}</span>
                        <span class="metric-value">${item.task_type}</span>
                    </div>
                `;
            });

            element.innerHTML = activityHtml;
        }

        function updateDepartmentGrid(departments) {
            const element = document.getElementById('department-grid');

            if (Object.keys(departments).length === 0) {
                element.innerHTML = '<div class="loading">No departments found</div>';
                return;
            }

            let departmentsHtml = '';
            Object.entries(departments).forEach(([deptName, deptData]) => {
                const efficiency = deptData.efficiency || 0;
                const statusColor = efficiency > 80 ? '#4CAF50' : efficiency > 60 ? '#ff9800' : '#f44336';

                departmentsHtml += `
                    <div class="department-card">
                        <h4>${deptName.toUpperCase()}</h4>
                        <div class="metric">
                            <span class="metric-label">Agents:</span>
                            <span class="metric-value">${deptData.active_agents}/${deptData.agent_count}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Efficiency:</span>
                            <span class="metric-value" style="color: ${statusColor}">${efficiency.toFixed(1)}%</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Tasks:</span>
                            <span class="metric-value">${deptData.completed_tasks}/${deptData.total_tasks}</span>
                        </div>
                        <button class="btn" style="margin-top: 10px; font-size: 0.9rem; padding: 8px 16px;"
                                onclick="restartDepartment('${deptName}')">
                            üîÑ Restart Department
                        </button>
                    </div>
                `;
            });

            element.innerHTML = departmentsHtml;
        }

        function updateAgentGrid(data) {
            // This would show individual agent status
            // For now, just show a summary
            const element = document.getElementById('agent-grid');
            element.innerHTML = `
                <div class="card">
                    <h3>ü§ñ Agent Summary</h3>
                    <div class="metric">
                        <span class="metric-label">Total Agents:</span>
                        <span class="metric-value">${data.overview?.total_agents || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Active Agents:</span>
                        <span class="metric-value">${data.overview?.active_agents || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">System Status:</span>
                        <span class="metric-value">${data.dashboard_status || 'Unknown'}</span>
                    </div>
                </div>
            `;
        }

        // Control functions
        async function restartAllAgents() {
            if (confirm('Are you sure you want to restart all agents?')) {
                const result = await apiCall('/api/agents/restart-all', 'POST');
                if (result) {
                    alert('All agents restarted successfully');
                    refreshDashboard();
                }
            }
        }

        async function restartDepartment(department) {
            if (confirm(`Are you sure you want to restart the ${department} department?`)) {
                const result = await apiCall(`/api/departments/${department}/restart`, 'POST');
                if (result) {
                    alert(`${department} department restarted successfully`);
                    refreshDashboard();
                }
            }
        }

        async function shutdownSystem() {
            if (confirm('Are you sure you want to shutdown the entire system? This will stop all agents.')) {
                const result = await apiCall('/api/system/shutdown', 'POST');
                if (result) {
                    alert('System shutdown initiated');
                    refreshDashboard();
                }
            }
        }

        async function executeEmergencyProtocol(protocol) {
            if (confirm(`Are you sure you want to execute the ${protocol} emergency protocol?`)) {
                const result = await apiCall(`/api/emergency/${protocol}`, 'POST');
                if (result) {
                    alert(`Emergency protocol ${protocol} executed successfully`);
                    refreshDashboard();
                }
            }
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;

            const container = document.querySelector('.container');
            container.insertBefore(errorDiv, container.firstChild);

            // Remove error after 5 seconds
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        // Auto-refresh every 30 seconds
        setInterval(refreshDashboard, 30000);
    </script>
</body>
</html>
